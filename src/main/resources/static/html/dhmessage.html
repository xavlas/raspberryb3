<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DHMessage</title>
    <script
            src="https://code.jquery.com/jquery-3.4.1.js"
            integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
            crossorigin="anonymous"></script>
    <script src="http://echarts.baidu.com/gallery/vendors/echarts/echarts-all-3.js"></script>
</head>
<body>
<h1 align="center">物联网综合实践</h1>
<div>
    <div id="main" style="width: 63%; height:60%; float: left;"></div>
    <div id="right" style="width: 35%; height:60%; float: right;"></div>
</div>
<button id="save">开始采集温湿度</button>
<button id="change">动态显示存储数量</button>
<script type="text/javascript">
    var rightChart = echarts.init(document.getElementById('right'));
    rightChart.showLoading({
        text:"正在加载数据"
    });
    function setchartRight(localPort, data) {

        var option = {
            title: {
                text: '本地端口前十分布图'
            },
            tooltip: {},
            legend: {
                data:['端口数量']
            },
            xAxis: {
                name:"端口号",
                data: localPort
            },
            yAxis: {
                name:"端口数量"
            },
            series: [{
                name: '端口数量',
                type: 'bar',
                data: data
            }]
        };
        rightChart.setOption(option);
    }
    function startRight() {
        var localPort = new Array();
        var data = new Array();
        $.ajax({url:"/show",
            type:"get",
            datatype:"json",
            success:function (result) {
                rightChart.hideLoading();
                $.each(result, function (index, obj) {
                    localPort[index] = obj['localPort'];
                    data[index] = obj['port'];
                });
                setchartRight(localPort, data);
            }});
    }
    startRight();



    $("#save").click(function () {
        $.getJSON("/raspberry3/collectdhmessage", function (data) {
            if (data.status == "success") {
                $("#save").text("正在存储数据");
            } else {
                $.toast("请不要多次存储");
            }
        })
    });





    var humidity= new Array();
    var temperature= new Array();
    $("#change").click(function () {
        myChart.showLoading({
            text:"正在加载数据"
        });
        setInterval(start, 10000);
    });

    var myChart = echarts.init(document.getElementById('main'));
    var leftOption = {
        title: {
            text: '动态存储信息'
        },
        tooltip: {},
        legend: {
            data:['存储数量']
        },
        xAxis: {
            name:"存储时间",
            data: dateTime
        },
        yAxis: {
            name:"存储数量"
        },
        series: [{
            name: '存储数量',
            type: 'line',
            data: count
        }]
    };
    function setchart(dateTime, count) {

        var option = {
            xAxis: {
                data: dateTime
            },
            yAxis: {},
            series: [{
                name: '存储数量',
                type: 'line',
                data: count
            }]
        };
        myChart.setOption(option);
    }
    myChart.setOption(leftOption);
    function start() {

        $.ajax({url:"/raspberry3/dhmessage",
            type:"get",
            datatype:"json",
            success:function (result) {
                myChart.hideLoading();
                for (var DHMessage in result) {
                    humidity.push(DHMessage.hu)
                }
                count.push(result.count);
                dateTime.push(result.time);
                setchart(dateTime, count);
            }});
    }
</script>

</body>
</html>